# 基本実行例

このドキュメントでは、`roo-code-profit-trend-display` の最も基本的な使用方法を説明します。

## 前提条件

- プログラムがビルド済みであること
- MySQLデータベースにアクセス可能であること
- 必要なテーブルとデータが存在すること
- Slack通知を使用する場合は、Slack Webhook URLが準備されていること

## 最初の実行

### 1. デフォルト設定での実行

```bash
cd cmd/roo-code-profit-trend-display
./bin/profit-trend-display
```

**実行結果例**:
```
=== 粗利推移表示プログラム ===
分析期間: 過去30日間
接続先: root:***@tcp(mysql.local:3306)/sample_mysql?parseTime=true

対象期間: 2024-06-21 から 2024-07-20 まで

データを取得中...
取得データ数: 45件
データを分析中...

=== 分析結果 ===
対象組織数: 2

(1/2) [株式会社テスト - 東京倉庫] 粗利推移 (過去30日間)
========================================

    500 ┬     ●           ●     ●
    400 ┤   ●   ●       ●   ●     ●
    300 ┤ ●       ●   ●           ●
    200 ┤           ● ●             ●
    100 ┤                           
      0 └─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─
        06/21   06/25   06/29   07/03   07/07

統計情報:
  最大粗利:        500 (06/22)
  最小粗利:        150 (07/04)
  平均粗利:        325
  合計粗利:       9750
  データ日数: 30日

--------------------------------------------------------------------------------

(2/2) [株式会社テスト - 大阪倉庫] 粗利推移 (過去30日間)
========================================

    800 ┬               ●
    640 ┤             ●   ●
    480 ┤           ●       ●
    320 ┤         ●           ●
    160 ┤       ●               ●
      0 └─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─
        06/21   06/25   06/29   07/03   07/07

統計情報:
  最大粗利:        800 (07/01)
  最小粗利:        200 (07/15)
  平均粗利:        500
  合計粗利:      15000
  データ日数: 30日

================================================================================
=== 粗利推移サマリー ===

全体統計:
  合計粗利:      24750
  平均粗利:        413
  最大粗利:        800 (07/01)
  最小粗利:        150 (07/04)
  対象組織数: 2

組織別サマリー:
  株式会社テスト - 東京倉庫: 合計=9750, 平均=325
  株式会社テスト - 大阪倉庫: 合計=15000, 平均=500

分析完了!
```

### 2. 出力内容の説明

#### ヘッダー情報
```
=== 粗利推移表示プログラム ===
分析期間: 過去30日間
接続先: root:***@tcp(mysql.local:3306)/sample_mysql?parseTime=true
```
- プログラム名
- 分析対象期間
- データベース接続先（パスワードはマスク）

#### 期間情報
```
対象期間: 2024-06-21 から 2024-07-20 まで
```
- 実際に分析される日付範囲

#### データ取得情報
```
データを取得中...
取得データ数: 45件
データを分析中...
```
- 処理進行状況
- 取得されたレコード数

#### 組織別チャート
```
(1/2) [株式会社テスト - 東京倉庫] 粗利推移 (過去30日間)
========================================

    500 ┬     ●           ●     ●
    400 ┤   ●   ●       ●   ●     ●
    300 ┤ ●       ●   ●           ●
    200 ┤           ● ●             ●
    100 ┤                           
      0 └─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─
        06/21   06/25   06/29   07/03   07/07
```

**チャート要素の説明**:
- `●`: 粗利データポイント
- `┬`, `┤`, `└`: チャート枠線
- `─`: 水平軸線
- 左側数値: Y軸（粗利金額）
- 下側日付: X軸（日付）

#### 統計情報
```
統計情報:
  最大粗利:        500 (06/22)
  最小粗利:        150 (07/04)
  平均粗利:        325
  合計粗利:       9750
  データ日数: 30日
```

各統計値の意味:
- **最大粗利**: 期間中の最高粗利とその日付
- **最小粗利**: 期間中の最低粗利とその日付
- **平均粗利**: 期間中の1日平均粗利
- **合計粗利**: 期間中の累計粗利
- **データ日数**: 分析対象日数

#### 全体サマリー
```
=== 粗利推移サマリー ===

全体統計:
  合計粗利:      24750
  平均粗利:        413
  最大粗利:        800 (07/01)
  最小粗利:        150 (07/04)
  対象組織数: 2

組織別サマリー:
  株式会社テスト - 東京倉庫: 合計=9750, 平均=325
  株式会社テスト - 大阪倉庫: 合計=15000, 平均=500
```

- 全組織を統合した統計情報
- 組織別の合計・平均粗利一覧

## 基本的なオプション使用例

### 1. 分析期間の変更

```bash
# 過去7日間の分析
./bin/profit-trend-display 7

# 過去14日間の分析
./bin/profit-trend-display -days 14

# 過去90日間の分析
./bin/profit-trend-display -days 90
```

### 2. サマリーのみ表示

```bash
# 詳細チャートをスキップしてサマリーのみ表示
./bin/profit-trend-display -summary
```

**サマリーのみの出力例**:
```
=== 粗利推移表示プログラム ===
分析期間: 過去30日間
接続先: root:***@tcp(mysql.local:3306)/sample_mysql?parseTime=true

対象期間: 2024-06-21 から 2024-07-20 まで

データを取得中...
取得データ数: 45件
データを分析中...

=== 分析結果 ===
対象組織数: 2

=== 粗利推移サマリー ===

全体統計:
  合計粗利:      24750
  平均粗利:        413
  最大粗利:        800 (07/01)
  最小粗利:        150 (07/04)
  対象組織数: 2

組織別サマリー:
  株式会社テスト - 東京倉庫: 合計=9750, 平均=325
  株式会社テスト - 大阪倉庫: 合計=15000, 平均=500

分析完了!
```

### 3. チャートサイズの調整

```bash
# 小さなチャート（幅40、高さ10）
./bin/profit-trend-display -width 40 -height 10

# 大きなチャート（幅100、高さ25）  
./bin/profit-trend-display -width 100 -height 25
```

### 4. グリッド線の制御

```bash
# グリッド線なしで表示
./bin/profit-trend-display -grid=false

# 統計情報なしで表示
./bin/profit-trend-display -stats=false
```

## Slack通知機能の使用例

### 1. Slack Webhook URLの設定

```bash
# 環境変数でSlack Webhook URLを設定
export SLACK_HOOK="https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX"

# 設定の確認
echo $SLACK_HOOK
```

### 2. Slack通知付きで実行

```bash
# 基本的なSlack通知実行（過去30日間）
./bin/profit-trend-display -slack

# 過去7日間の分析結果をSlackに通知
./bin/profit-trend-display -slack -days 7

# サマリーのみをSlackに通知
./bin/profit-trend-display -slack -summary

# 大きなチャートでSlack通知
./bin/profit-trend-display -slack -width 80 -height 20
```

**Slack通知付き実行結果例**:
```
=== 粗利推移表示プログラム ===
分析期間: 過去7日間
接続先: root:***@tcp(mysql.local:3306)/sample_mysql?parseTime=true
Slack通知: 有効

対象期間: 2024-07-14 から 2024-07-20 まで

データを取得中...
取得データ数: 14件
データを分析中...

=== 分析結果 ===
対象組織数: 2

(1/2) [株式会社テスト - 東京倉庫] 粗利推移 (過去7日間)
========================================

    500 ┬   ●       ●
    400 ┤ ●   ●   ●   ●
    300 ┤       ●       ●
    200 ┤               
    100 ┤               
      0 └─┬─┬─┬─┬─┬─┬─
        07/14 07/16 07/18 07/20

統計情報:
  最大粗利:        500 (07/15)
  最小粗利:        300 (07/17)
  平均粗利:        400
  合計粗利:       2800
  データ日数: 7日

Slack通知を送信中...
Slack通知送信完了

分析完了!
```

### 3. 環境変数が未設定の場合

```bash
# SLACK_HOOK環境変数が設定されていない状態で-slackオプションを使用
./bin/profit-trend-display -slack -days 7
```

**出力例**:
```
=== 粗利推移表示プログラム ===
分析期間: 過去7日間
接続先: root:***@tcp(mysql.local:3306)/sample_mysql?parseTime=true
Slack通知: 無効（SLACK_HOOK環境変数が未設定）

対象期間: 2024-07-14 から 2024-07-20 まで

データを取得中...
取得データ数: 14件
データを分析中...

=== 分析結果 ===
対象組織数: 2

Slack通知が無効のため、通知をスキップします

分析完了!
```

### 4. ワンライナーでの実行

```bash
# 環境変数設定と同時に実行
SLACK_HOOK="https://hooks.slack.com/services/..." ./bin/profit-trend-display -slack -days 14 -summary

# 本番環境での実行例
SLACK_HOOK="${PROD_SLACK_WEBHOOK}" ./bin/profit-trend-display -slack -days 30 -dsn "${PROD_DB_DSN}"
```

### 5. Slack通知エラーの場合

```bash
# 無効なWebhook URLや接続エラーの場合
export SLACK_HOOK="https://invalid-webhook-url.com/test"
./bin/profit-trend-display -slack -days 7
```

**出力例**:
```
=== 粗利推移表示プログラム ===
分析期間: 過去7日間
接続先: root:***@tcp(mysql.local:3306)/sample_mysql?parseTime=true
Slack通知: 有効

対象期間: 2024-07-14 から 2024-07-20 まで

データを取得中...
取得データ数: 14件
データを分析中...

=== 分析結果 ===
対象組織数: 2

(詳細チャート表示)

Slack通知を送信中...
Slack通知送信に失敗しました: Post "https://invalid-webhook-url.com/test": dial tcp: lookup invalid-webhook-url.com: no such host

分析完了!
```

**注意**: Slack通知エラーが発生しても、メイン処理は正常に継続されます。

## Slackで受信されるメッセージ例

### 正常終了時の通知

```
📊 粗利推移分析結果 (過去7日間)

【全体統計】
• 合計粗利: 245,000円
• 平均粗利: 35,000円
• 最大粗利: 55,000円 (07/18)
• 最小粗利: 18,000円 (07/16)
• 対象組織数: 2

【組織別トップ3】
1. 株式会社テスト - 東京倉庫: 140,000円
2. 株式会社テスト - 大阪倉庫: 105,000円

実行日時: 2024-07-20 14:30:25
```

### エラー発生時の通知

```
❌ 粗利分析エラー

エラー内容: データベース接続エラー
詳細: dial tcp 127.0.0.1:3306: connect: connection refused

対処方法:
• MySQLサーバーの起動状態を確認してください
• ネットワーク接続を確認してください
• DSN設定を確認してください

発生日時: 2024-07-20 14:35:12
```

## ヘルプの表示

```bash
# ヘルプメッセージの表示
./bin/profit-trend-display -help
```

**ヘルプ出力例**:
```
粗利推移表示プログラム

使用方法:
  profit-trend-display [オプション] [日数]

オプション:
  -dsn string       データベース接続文字列 (default: root:mypass@tcp(mysql.local:3306)/sample_mysql?parseTime=true)
  -days int         分析対象日数 (default: 30)
  -width int        グラフ幅 (default: 60)
  -height int       グラフ高さ (default: 15)
  -grid             グリッド線を表示 (default: true)
  -stats            統計情報を表示 (default: true)
  -summary          サマリーのみ表示 (default: false)
  -slack            Slack通知を有効化 (default: false)
  -help             このヘルプを表示

環境変数:
  SLACK_HOOK        SlackのIncoming Webhook URL

例:
  profit-trend-display                    # デフォルト設定で実行
  profit-trend-display -days 7            # 過去7日間を分析
  profit-trend-display -summary           # サマリーのみ表示
  profit-trend-display -slack             # Slack通知付きで実行
  profit-trend-display -slack -days 14 -summary  # 14日間サマリーをSlack通知
  profit-trend-display -width 80 -height 20      # グラフサイズ変更

機能:
  - 売上データと原価データから粗利を計算
  - 会社別・倉庫別にグループ化して表示
  - テキストベースのグラフで推移を視覚化
  - 統計情報（最大・最小・平均・合計）を表示
  - 欠損日のデータは0として補完
  - Slack通知による結果共有
```

## よくある初回実行での問題

### 1. 「データベース接続エラー」が発生する場合

```bash
データベース接続エラー: dial tcp 127.0.0.1:3306: connect: connection refused
```

**対処法**:
- MySQLサーバーが起動しているか確認
- 接続情報（ホスト、ポート、ユーザー、パスワード）を確認
- `-dsn` オプションで正しい接続文字列を指定

### 2. 「データが見つかりませんでした」が表示される場合

```bash
指定された期間にデータが見つかりませんでした。
```

**対処法**:
- データベースに売上・原価データが存在するか確認
- 分析期間を長くしてみる（`-days 90` など）
- テーブル構造が正しいか確認

### 3. プログラムが見つからない場合

```bash
./bin/profit-trend-display: No such file or directory
```

**対処法**:
```bash
# ビルドを実行
make build

# または手動ビルド
go build -o bin/profit-trend-display .
```

### 4. Slack通知関連の問題

#### Webhook URLが無効な場合
```bash
Slack通知送信に失敗しました: Post "https://hooks.slack.com/services/...": 404 page not found
```

**対処法**:
- Slack Webhook URLが正しいか確認
- Slackアプリの設定を確認
- Webhook URLの有効期限を確認

#### ネットワーク接続エラー
```bash
Slack通知送信に失敗しました: dial tcp: lookup hooks.slack.com: no such host
```

**対処法**:
- インターネット接続を確認
- ファイアウォール設定を確認
- プロキシ設定が必要な場合は環境変数を設定

## 次のステップ

基本的な実行ができたら、以下の応用例も試してみてください：

1. **[カスタム設定例](custom-settings.md)** - より詳細な設定オプション
2. **[出力サンプル](output-samples/)** - 様々な設定での出力例
3. **[高度な使用例](../advanced-usage/)** - バッチ処理や自動化
4. **[自動化ガイド](../../tutorials/automation-guide.md)** - Slack統合を含む自動化

---

**💡 ヒント**: 
- 初回実行時は `-days 7 -summary` オプションで軽量な実行を試してみることをお勧めします
- Slack通知をテストする際は、まず少ないデータで `-slack -days 1 -summary` を試してください
- 本番環境では環境変数を適切に設定し、セキュリティに注意してください